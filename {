Script started on Tue 10 Sep 2019 09:55:08 PM EDT
                        docker.withRegistry('https://registry.hub.docker.com', 'dockerhub_creds') {
                            sh "sshpass -p '$USERPASS' -v ssh -o StrictHostKeyChecking=no $USERNAME@$prod_ip \"docker pull akarshthodupunuri/train-schedule:${env.BUILD_NUMBER}\""
                            try {
                                sh "sshpass -p '$USERPASS' -v ssh -o StrictHostKeyChecking=no $USERNAME@$prod_ip \"docker stop train-schedule\""
                                sh "sshpass -p '$USERPASS' -v ssh -o StricthostKeychecking=no $USERNAME@$prod_ip \"docker rm train-schedule\""
                            } catch (err) {
                                echo: 'caught error: $err'
                            }
                            sh "sshpass -p $USERPASS -v ssh -o StrictHostkeyChecking=no $USERNAME@$prod_ip \"docker run --restart=always --name train-schedule -p 8080:8080 -d akarshthodupunuri/train-schedule:${env.BUILD_NUMBER}\""
                        }

                    }
                }

            }
        }
    }
}]0;cloud_user@ip-10-0-1-233:~/cicd-pipeline-train-schedule-dockerdeploy[?1034h[cloud_user@ip-10-0-1-233 cicd-pipeline-train-schedule-dockerdeploy]$                         docker.withRegistry('https://registry.hub.docker.com', 'dockerhub_creds') {
bash: syntax error near unexpected token `'https://registry.hub.docker.com','
]0;cloud_user@ip-10-0-1-233:~/cicd-pipeline-train-schedule-dockerdeploy[cloud_user@ip-10-0-1-233 cicd-pipeline-train-schedule-dockerdeploy]$                             sh "sshpass -p '$USERPASS' -v ssh -o StrictHostKeyChecking=no $USERNAME@$prod_ip \"docker pull a karshthodupunuri/train-schedule:${env.BUILD_NUMBER}\""
bash: sshpass -p '$USERPASS' -v ssh -o StrictHostKeyChecking=no $USERNAME@$prod_ip "docker pull akarshthodupunuri/train-schedule:${env.BUILD_NUMBER}": bad substitution
]0;cloud_user@ip-10-0-1-233:~/cicd-pipeline-train-schedule-dockerdeploy[cloud_user@ip-10-0-1-233 cicd-pipeline-train-schedule-dockerdeploy]$                             try {
bash: try: command not found
]0;cloud_user@ip-10-0-1-233:~/cicd-pipeline-train-schedule-dockerdeploy[cloud_user@ip-10-0-1-233 cicd-pipeline-train-schedule-dockerdeploy]$                                 sh "sshpass -p '$USERPASS' -v ssh -o StrictHostKeyChecking=no $USERNAME@$prod_ip \"docker st op train-schedule\""
sh: sshpass -p '' -v ssh -o StrictHostKeyChecking=no @ "docker stop train-schedule": No such file or directory
]0;cloud_user@ip-10-0-1-233:~/cicd-pipeline-train-schedule-dockerdeploy[cloud_user@ip-10-0-1-233 cicd-pipeline-train-schedule-dockerdeploy]$                                 sh "sshpass -p '$USERPASS' -v ssh -o StricthostKeychecking=no $USERNAME@$prod_ip \"docker rm  train-schedule\""
sh: sshpass -p '' -v ssh -o StricthostKeychecking=no @ "docker rm train-schedule": No such file or directory
]0;cloud_user@ip-10-0-1-233:~/cicd-pipeline-train-schedule-dockerdeploy[cloud_user@ip-10-0-1-233 cicd-pipeline-train-schedule-dockerdeploy]$                             } catch (err) {
bash: syntax error near unexpected token `}'
]0;cloud_user@ip-10-0-1-233:~/cicd-pipeline-train-schedule-dockerdeploy[cloud_user@ip-10-0-1-233 cicd-pipeline-train-schedule-dockerdeploy]$                                 echo: 'caught error: $err'
bash: echo:: command not found
]0;cloud_user@ip-10-0-1-233:~/cicd-pipeline-train-schedule-dockerdeploy[cloud_user@ip-10-0-1-233 cicd-pipeline-train-schedule-dockerdeploy]$                             }
bash: syntax error near unexpected token `}'
]0;cloud_user@ip-10-0-1-233:~/cicd-pipeline-train-schedule-dockerdeploy[cloud_user@ip-10-0-1-233 cicd-pipeline-train-schedule-dockerdeploy]$                             sh "sshpass -p $USERPASS -v ssh -o StrictHostkeyChecking=no $USERNAME@$prod_ip \"docker run --re start=always --name train-schedule -p 8080:8080 -d akarshthodupunuri/train-schedule:${env.BUILD_NUMBER}\""
bash: sshpass -p $USERPASS -v ssh -o StrictHostkeyChecking=no $USERNAME@$prod_ip "docker run --restart=always --name train-schedule -p 8080:8080 -d akarshthodupunuri/train-schedule:${env.BUILD_NUMBER}": bad substitution
]0;cloud_user@ip-10-0-1-233:~/cicd-pipeline-train-schedule-dockerdeploy[cloud_user@ip-10-0-1-233 cicd-pipeline-train-schedule-dockerdeploy]$                         }
bash: syntax error near unexpected token `}'
]0;cloud_user@ip-10-0-1-233:~/cicd-pipeline-train-schedule-dockerdeploy[cloud_user@ip-10-0-1-233 cicd-pipeline-train-schedule-dockerdeploy]$ 
]0;cloud_user@ip-10-0-1-233:~/cicd-pipeline-train-schedule-dockerdeploy[cloud_user@ip-10-0-1-233 cicd-pipeline-train-schedule-dockerdeploy]$                     }
bash: syntax error near unexpected token `}'
]0;cloud_user@ip-10-0-1-233:~/cicd-pipeline-train-schedule-dockerdeploy[cloud_user@ip-10-0-1-233 cicd-pipeline-train-schedule-dockerdeploy]$                 }
bash: syntax error near unexpected token `}'
]0;cloud_user@ip-10-0-1-233:~/cicd-pipeline-train-schedule-dockerdeploy[cloud_user@ip-10-0-1-233 cicd-pipeline-train-schedule-dockerdeploy]$ 
]0;cloud_user@ip-10-0-1-233:~/cicd-pipeline-train-schedule-dockerdeploy[cloud_user@ip-10-0-1-233 cicd-pipeline-train-schedule-dockerdeploy]$             }
bash: syntax error near unexpected token `}'
]0;cloud_user@ip-10-0-1-233:~/cicd-pipeline-train-schedule-dockerdeploy[cloud_user@ip-10-0-1-233 cicd-pipeline-train-schedule-dockerdeploy]$         }
bash: syntax error near unexpected token `}'
]0;cloud_user@ip-10-0-1-233:~/cicd-pipeline-train-schedule-dockerdeploy[cloud_user@ip-10-0-1-233 cicd-pipeline-train-schedule-dockerdeploy]$     }
bash: syntax error near unexpected token `}'
]0;cloud_user@ip-10-0-1-233:~/cicd-pipeline-train-schedule-dockerdeploy[cloud_user@ip-10-0-1-233 cicd-pipeline-train-schedule-dockerdeploy]$ }rm Jenkinsfile 
bash: }rm: command not found
]0;cloud_user@ip-10-0-1-233:~/cicd-pipeline-train-schedule-dockerdeploy[cloud_user@ip-10-0-1-233 cicd-pipeline-train-schedule-dockerdeploy]$ vi Jen[K[K[K[K[K[Krm Jenkinsfile 
]0;cloud_user@ip-10-0-1-233:~/cicd-pipeline-train-schedule-dockerdeploy[cloud_user@ip-10-0-1-233 cicd-pipeline-train-schedule-dockerdeploy]$ vi Jenkinsfile
[?1049h[?1h=[2;1Hâ–½[6n[1;1H  [1;1H[1;59r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[59;1H"Jenkinsfile" [New File][>c[2;1H[94m~                                                                                                                                                                                                 [3;1H~                                                                                                                                                                                                 [4;1H~                                                                                                                                                                                                 [5;1H~                                                                                                                                                                                                 [6;1H~                                                                                                                                                                                                 [7;1H~                                                                                                                                                                                                 [8;1H~                                                                                                                                                                                                 [9;1H~                                                                                                                                                                                                 [10;1H~                                                                                                                                                                                                 [11;1H~                                                                                                                                                                                                 [12;1H~                                                                                                                                                                                                 [13;1H~                                                                                                                                                                                                 [14;1H~                                                                                                                                                                                                 [15;1H~                                                                                                                                                                                                 [16;1H~                                                                                                                                                                                                 [17;1H~                                                                                                                                                                                                 [18;1H~                                                                                                                                                                                                 [19;1H~                                                                                                                                                                                                 [20;1H~                                                                                                                                                                                                 [21;1H~                                                                                                                                                                                                 [22;1H~                                                                                                                                                                                                 [23;1H~                                                                                                                                                                                                 [24;1H~                                                                                                                                                                                                 [25;1H~                                                                                                                                                                                                 [26;1H~                                                                                                                                                                                                 [27;1H~                                                                                                                                                                                                 [28;1H~                                                                                                                                                                                                 [29;1H~                                                                                                                                                                                                 [30;1H~                                                                                                                                                                                                 [31;1H~            [4;1H~                                                                                                                                                                                                 [5;1H~                                                                                                                                                                                                 [6;1H~                                                                                                                                                                                                 [7;1H~                                                                                                                                                                                                 [8;1H~                                                                                                                                                                                                 [9;1H~                                                                                                                                                                                                 [10;1H~                                                                                                                                                                                                 [11;1H~                                                                                                                                                                                                 [12;1H~                                                                                                                                                                                                 [13;1H~                                                                                                                                                                                                 [14;1H~                                                                                                                                                                                                 [15;1H~                                                                                                                                                                                                 [16;1H~                                                                                                                                                                                                 [17;1H~                                                                                                                                                                                                 [18;1H~                                                                                                                                                                                                 [19;1H~                                                                                                                                                                                                 [20;1H~                                                                                                                                                                                                 [21;1H~                                                                                                                                                                                                 [22;1H~                                                                                                                                                                                                 [23;1H~                                                                                                                                                                                                 [24;1H~                                                                                                                                                                                   [52;1H~                                                                                                                                                                                                 [53;1H~                                                                                                                                                                                                 [54;1H~                                                                                                                                                                                                 [55;1H~                                                                                                                                                                                                 [56;1H~                                                                                                                                                                                                 [57;1H~                                                                                                                                                                                                 [58;1H~                                                                                                                                                                                                 [m[59;177H0,0-1[9CAll[1;1H[?12l[?25h[?25l[59;1H[1m-- INSERT --[m[59;13H[K[59;177H0,1[11CAll[1;1H[?12l[?25h[?25lpipeline {
    agent any[2;14H[K[3;1H    stages {[3;13H[K[4;1H        stage('Build') {[4;25H[K[5;1H            steps {[5;20H[K[6;1H                echo 'Running build automation'[6;48H[K[7;1H                sh './gradlew build --no-daemon'[7;49H[K[8;1H                archiveArtifacts artifacts: 'dist/trainSchedule.zip'[8;69H[K[9;1H            }[9;14H[K[10;1H        }[10;10H[K[11;1H        stage('building the docker image') {[11;45H[K[12;1H            when {[12;19H[K[13;1H                branch 'master'[13;32H[K[14;1H            }[14;14H[K[15;1H            steps {[15;20H[K[16;1H                script {[16;25H[K[17;1H                    app = docker.build("akarshthodupunuri/train-schedule")[17;75H[K[18;1H                    app.inside {[18;33H[K[19;1H                        sh 'echo $(curl localhost:8080)'[19;57H[K[20;1H                    }[20;22H[K[21;1H                }[21;18H[K[22;1H            }[22;14H[K[23;1H        }[23;10H[K[24;1H        stage('Push the docker image to registry') {[24;53H[K[25;1H            when {[25;19H[K[26;1H                branch 'master'[26;32H[K[27;1H       [27;8H[K[59;177H27,8[27;8H[?12l[?25h[?25l     }
            steps {[28;20H[K[29;1H                script {[29;25H[K[30;1H                    docker.withRegistry('https://registry.hub.docker.com', 'dockerhub_creds') {[30;96H[K[31;1H                        app.push("${env.BUILD_NUMBER}")[31;56H[K[32;1H                        app.push("latest")[32;43H[K[33;1H                    }[33;22H[K[34;1H                }[34;18H[K[35;1H            }[35;14H[K[36;1H        }[36;10H[K[37;1H        stage('Deploy to Production') {[37;40H[K[38;1H            when {[38;19H[K[39;1H                branch 'master'[39;32H[K[40;1H            }[40;14H[K[41;1H            steps {[41;20H[K[42;1H                input 'Deploy to Production?'[42;46H[K[43;1H                milestone(1)[43;29H[K[44;1H                withCredentials([usernamePassword(credentialsId: 'webserver_creds', passwordVariable: 'USERPASS', usernameVariable: 'USERNAME')]) {[44;148H[K[45;1H                    script {[45;29H[K[46;1H                        docker.withRegistry('https://registry.hub.docker.com', '[46;81H[K[59;177H46,81[46;81H[?12l[?25h[?25ldockerhub_creds') {
                            sh "sshpass -p '$USERPASS' -v ssh -o Str                                                       [45;1H~                                                                                                                                                                                                 [46;1H~                                                                                                                                                                                                 [47;1H~                                                                                                                                                                                                 [48;1H~                                                                                                                                                                                                 [49;1H~                                                                                                                                                                                                 [50;1H~                                                                                                                                                                                                 [51;1H~                                                                                                                                                                                                 [52;1H~                                                                                                                                                                                                 [53;1H~                                                                                                                                                                                                 [54;1H~                                                                                                                                                                                                 [55;1H~                                                                                                                                                                                                 [56;1H~                                                                                                                                                                                                 [57;1H~                                                                                                                                                                                                 [58;1H~                                                                                                                                                                                                 [m[59;177H0,0-1[9CAll[1;1H[?12l[?25h[?25l[59;1H[1m-- INSERT --[m[59;13H[K[59;177H0,1[11CAll[1;1H[?12l[?25h[?25lpipeline {
    agent any[2;14H[K[3;1H    stages {[3;13H[K[4;1H        stage('Build') {[4;25H[K[5;1H            steps {[5;20H[K[6;1H                echo 'Running build automation'[6;48H[K[7;1H                sh './gradlew build --no-daemon'[7;49H[K[8;1H                archiveArtifacts artifacts: 'dist/trainSchedule.zip'[8;69H[K[9;1H            }[9;14H[K[10;1H        }[10;10H[K[11;1H        stage('building the docker image') {[11;45H[K[12;1H            when {[12;19H[K[13;1H                branch 'master'[13;32H[K[14;1H            }[14;14H[K[15;1H            steps {[15;20H[K[16;1H                script {[16;25H[K[17;1H                    app = docker.build("akarshthodupunuri/train-schedule")[17;75H[K[18;1H                    app.inside {[18;33H[K[19;1H                        sh 'echo $(curl localhost:8080)'[19;57H[K[20;1H                    }[20;22H[K[21;1H                }[21;18H[K[22;1H            }[22;14H[K[23;1H        }[23;10H[K[24;1H        stage('Push the docker image to registry') {[24;53H[K[25;1H            when {[25;19H[K[26;1H                branch 'master'[26;32H[K[27;1H       [27;8H[K[59;177H27,8[27;8H[?12l[?25h[?25l     }
            steps {[28;20H[K[29;1H                script {[29;25H[K[30;1H                    docker.withRegistry('https://registry.hub.docker.com', 'dockerhub_creds') {[30;96H[K[31;1H                        app.push("${env.BUILD_NUMBER}")[31;56H[K[32;1H                        app.push("latest")[32;43H[K[33;1H                    }[33;22H[K[34;1H                }[34;18H[K[35;1H            }[35;14H[K[36;1H        }[36;10H[K[37;1H        stage('Deploy to Production') {[37;40H[K[38;1H            when {[38;19H[K[39;1H                branch 'master'[39;32H[K[40;1H            }[40;14H[K[41;1H            steps {[41;20H[K[42;1H                input 'Deploy to Production?'[42;46H[K[43;1H                milestone(1)[43;29H[K[44;1H                withCredentials([usernamePassword(credentialsId: 'webserver_creds', passwordVariable: 'USERPASS', usernameVariable: 'USERNAME')]) {[44;148H[K[45;1H                    script {[45;29H[K[46;1H                        docker.withRegistry('https://registry.hub.docker.com', '[46;81H[K[59;177H46,81[46;81H[?12l[?25h[?25ldockerhub_creds') {
                            sh "sshpass -p '$USERPASS' -v ssh -o StrictHostKeyChecking=no $USERNAME@$prod_ip \"docker pull akarshthodupunuri/train-schedule:${env.BUILD_NUMBER}\""[47;179H[K[48;1H                            try {[48;34H[K[49;1H                                sh "sshpass -p '$USERPASS' -v ssh -o StrictHostKeyChecking=no $USERNAME@$prod_ip \"docker stop train-schedule\""[49;145H[K[50;1H                                sh "sshpass -p '$USERPASS' -v ssh -o StricthostKeychecking=no $USERNAME@$prod_ip \"docker rm train-schedule\""[50;143H[K[51;1H                            } catch (err) {[51;44H[K[52;1H                                echo: 'caught error: $err'[52;59H[K[53;1H                            }[53;30H[K[54;1H                            sh "sshpass -p $USERPASS -v ssh -o StrictHostkeyChecking=no $USERNAME@$prod_ip \"docke[54;115H[K[59;177H54,115[54;115H[?12l[?25h[?25l[1;1H                sh './gradlew build --no-daemon'
                archiveArtifacts artifacts: 'dist/trainSchedule.zip'
            }[4;9H}[4;10H[K[5;9Hstage('building the docker image') {[6;13Hwhen {[6;19H[K[7;17Hbranch 'master'[7;32H[K[8;13H}[8;17H[K[9;13Hsteps {[10;9H [7Cscript {[11;9H            app = docker.build("akarshthodupunuri/train-schedule")[12;13H        app.inside {[13;17H        sh 'echo $(curl localhost:8080)'[14;13H [7C}[15;13H    }[15;19H[K[16;13H}[16;17H[K[17;9H}[17;21H[K[18;9Hstage('Push the docker image to registry') {[19;13Hwhen {[19;25H[K[20;17Hbranch 'master'[21;13H}[21;17H[K[22;13Hsteps {[23;9H [7Cscript {[24;9H            docker.withRegistry('https://registry.hub.docker.com', 'dockerhub_creds') {[25;13H            app.push("${env.BUILD_NUMBER}")[26;17H        app.push("latest")[27;13H [7C}[28;13H    }[28;19H[K[29;13H}[29;17H[K[30;9H}[30;21H[K[31;9Hstage('Deploy to Production') {[31;40H[K[32;13Hwhen {[32;25H[K[33;17Hbranch 'master'[34;13H}[34;17H[K[35;13Hsteps {[36;9H [7Cinput 'Deploy to Production?'[37;9H        milestone(1)[37;29H[K[38;13H    withCredentials([usernamePassword(credentialsId: 'webserver_creds', passwordVariable: 'USERPASS', usernameVariable: 'USERNAME')]) {[39;17H    script {[39;29H[K[40;13H [11Cdocker.withRegistry('https://registry.hub.docker.com', 'dockerhub_creds') {[41;13H       [9Csh "sshpass -p '$USERPASS' -v ssh -o StrictHostKeyChecking=no $USERNAME@$prod_ip \"docker pull akarshthodupunuri/train-schedule:${env.BUILD_NUMBER}\""[42;17H            try {[42;34H[K[43;17H                sh "sshpass -p '$USERPASS' -v ssh -o StrictHostKeyChecking=no $USERNAME@$prod_ip \"docker stop train-schedule\""[44;17H                sh "sshpass -p '$USERPASS' -v ssh -o StricthostKeychecking=no $USERNAME@$prod_ip \"docker rm train-schedule\""[44;               sh './gradlew build --no-daemon'[7;49H[K[8;1H                archiveArtifacts artifacts: 'dist/trainSchedule.zip'[8;69H[K[9;1H            }[9;14H[K[10;1H        }[10;10H[K[11;1H        stage('building the docker image') {[11;45H[K[12;1H            when {[12;19H[K[13;1H                branch 'master'[13;32H[K[14;1H            }[14;14H[K[15;1H            steps {[15;20H[K[16;1H                script {[16;25H[K[17;1H                    app = docker.build("akarshthodupunuri/train-schedule")[17;75H[K[18;1H                    app.inside {[18;33H[K[19;1H                        sh 'echo $(curl localhost:8080)'[19;57H[K[20;1H                    }[20;22H[K[21;1H                }[21;18H[K[22;1H            }[22;14H[K[23;1H        }[23;10H[K[24;1H        stage('Push the docker image to registry') {[24;53H[K[25;1H            when {[25;19H[K[26;1H                branch 'master'[26;32H[K[27;1H       [27;8H[K[59;177H27,8[27;8H[?12l[?25h[?25l     }
            steps {[28;20H[K[29;1H                script {[29;25H[K[30;1H                    docker.withRegistry('https://registry.hub.docker.com', 'dockerhub_creds') {[30;96H[K[31;1H                        app.push("${env.BUILD_NUMBER}")[31;56H[K[32;1H                        app.push("latest")[32;43H[K[33;1H                    }[33;22H[K[34;1H                }[34;18H[K[35;1H            }[35;14H[K[36;1H        }[36;10H[K[37;1H        stage('Deploy to Production') {[37;40H[K[38;1H            when {[38;19H[K[39;1H                branch 'master'[39;32H[K[40;1H            }[40;14H[K[41;1H            steps {[41;20H[K[42;1H                input 'Deploy to Production?'[42;46H[K[43;1H                milestone(1)[43;29H[K[44;1H                withCredentials([usernamePassword(credentialsId: 'webserver_creds', passwordVariable: 'USERPASS', usernameVariable: 'USERNAME')]) {[44;148H[K[45;1H                    script {[45;29H[K[46;1H                        docker.withRegistry('https://registry.hub.docker.com', '[46;81H[K[59;177H46,81[46;81H[?12l[?25h[?25ldockerhub_creds') {
                            sh "sshpass -p '$USERPASS' -v ssh -o StrictHostKeyChecking=no $USERNAME@$prod_ip \"docker pull akarshthodupunuri/train-schedule:${env.BUILD_NUMBER}\""[47;179H[K[48;1H                            try {[48;34H[K[49;1H                                sh "sshpass -p '$USERPASS' -v ssh -o StrictHostKeyChecking=no $USERNAME@$prod_ip \"docker stop train-schedule\""[49;145H[K[50;1H                                sh "sshpass -p '$USERPASS' -v ssh -o StricthostKeychecking=no $USERNAME@$prod_ip \"docker rm train-schedule\""[50;143H[K[51;1H                            } catch (err) {[51;44H[K[52;1H                                echo: 'caught error: $err'[52;59H[K[53;1H                            }[53;30H[K[54;1H                            sh "sshpass -p $USERPASS -v ssh -o StrictHostkeyChecking=no $USERNAME@$prod_ip \"docke[54;115H[K[59;177H54,115[54;115H[?12l[?25h[?25l[1;1H                sh './gradlew build --no-daemon'
                archiveArtifacts artifacts: 'dist/trainSchedule.zip'
            }[4;9H}[4;10H[K[5;9Hstage('building the docker image') {[6;13Hwhen {[6;19H[K[7;17Hbranch 'master'[7;32H[K[8;13H}[8;17H[K[9;13Hsteps {[10;9H [7Cscript {[11;9H            app = docker.build("akarshthodupunuri/train-schedule")[12;13H        app.inside {[13;17H        sh 'echo $(curl localhost:8080)'[14;13H [7C}[15;13H    }[15;19H[K[16;13H}[16;17H[K[17;9H}[17;21H[K[18;9Hstage('Push the docker image to registry') {[19;13Hwhen {[19;25H[K[20;17Hbranch 'master'[21;13H}[21;17H[K[22;13Hsteps {[23;9H [7Cscript {[24;9H            docker.withRegistry('https://registry.hub.docker.com', 'dockerhub_creds') {[25;13H            app.push("${env.BUILD_NUMBER}")[26;17H        app.push("latest")[27;13H [7C}[28;13H    }[28;19H[K[29;13H}[29;17H[K[30;9H}[30;21H[K[31;9Hstage('Deploy to Production') {[31;40H[K[32;13Hwhen {